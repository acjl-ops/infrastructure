#!/usr/bin/env bash

if [ ! -d "$HOME/.devbox" ]; then
	mkdir -p "$HOME/.devbox"
fi

if ! docker volume inspect devbox-vol >/dev/null 2>&1; then
	docker volume create \
		--driver local \
		--opt type=none \
		--opt device="$HOME/.devbox" \
		--opt o=bind \
		devbox-vol \
		>/dev/null 2>&1
fi

if ! docker container inspect devbox-container >/dev/null 2>&1; then
	docker create \
		--name devbox-container \
		--hostname devbox \
		--user luis \
		--volume devbox-vol:/home/luis/ \
		--volume /:/mnt \
		--volume /dev/shm:/dev/shm \
		--cap-add SYS_PTRACE \
		--cap-add IPC_LOCK \
		--security-opt=apparmor:unconfined \
		ljmf00/devbox \
		>/dev/null 2>&1
fi

docker start devbox-container >/dev/null 2>&1
