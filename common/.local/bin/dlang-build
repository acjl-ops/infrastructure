#!/usr/bin/env bash

if [[ "$1" == "" ]]; then
  set -- release
else
  if [[ "$1" == *all* ]]; then
    set --debug-release
  fi

  if [[ "$1" == *full* ]]; then
    FULL_BUILD=1
  else
    FULL_BUILD=0
  fi
fi

function build_type()
{
  ./src/build.d BUILD="$1"

  if [[ "$FULL_BUILD" == "true" ]]; then
    (cd ../druntime && make -f posix.mak "-j$(nproc --all)" BUILD="$1")
    (cd ../phobos && make -f posix.mak "-j$(nproc --all)" BUILD="$1")
  fi
}

if [[ "$1" == *debug* ]]; then
  build_type "debug"
fi
if [[ "$1" == *release* ]]; then
  build_type "release"
fi
